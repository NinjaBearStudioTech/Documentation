# Loot Management
<primary-label ref="inventory"/>

<tldr>
    <p><b>Summary: Loot Management</b></p>
    <br/>
    <ul>
        <li>The Loot System is an integration between two Inventory Managers, one <b>requesting loot</b> and one <b>generating it</b>.</li>
        <li>You can define any <b>loot generation strategy</b> using objects that are external to the Inventory Manager, allowing <b>per-inventory strategies</b>.</li>
        <li><b>Loot events</b> are broadcast to support integration with other layers, such as the user interface.</li>
    </ul>
</tldr>

The Loot System in the Ninja Inventory plugin enables actors to grant items to a requesting inventory—such as looting a
defeated enemy, opening a chest, or collecting a reward.

The system supports both **instanced items** and **default items**, enabling flexible generation and transfer workflows.

## Loot Workflow

Loot flows between a **requester** and a **source** Inventory Manager.

1. The **requester** initiates the process by invoking `GenerateLoot` on a **source** Inventory Manager.
2. **Loot is generated** by a **loot selector** configured on the **source**, returning a list of `InventoryDefaultItem` entries.
3. **Loot is sent** to the requester via `ReceiveLoot`, which stores the loot for validation and broadcasts events that can be tracked by the user interface.
4. **Loot is visualized** by the UI using the appropriate **Inventory Loot ViewModel**. It will convert loot entries into the UI-oriented `UNinjaInventoryDetachedItemView` object.
5. **Selected loot is transferred** back to the requester using `TransferLoot`. This can also be done via the ViewModel.

## Loot Generation

Loot is generated by a class that implements `InventoryLootSelector`. These classes are responsible for
gathering potential loot options and presenting them back to the requester.

> **Conditional Loot**
>
> Since the Loot Generation API is aware of the requester, you can create complex criteria that, for example,
> favor certain hero classes or behave differently based on game progression.
{style="note"}

You can define the **Loot Generation Strategy** in the **Inventory Manager**. The system provides the following
predefined strategies:

| Strategy             | Description                                                                                                                                   |
|----------------------|-----------------------------------------------------------------------------------------------------------------------------------------------|
| `DataTable`          | Selects loot based on a **data table** containing predefined items, drop chances, and loot costs. Uses the `InventoryLootTableRow` structure. |
| `InventoryItems`     | Selects loot from the Inventory Manager’s existing items. Selection is based on the **[Loot Fragment](inv_fragment_loot.md)**.                |
| `LootableContainers` | Selects loot from containers that have the **lootable** trait.                                                                                |

You can create custom strategies by extending `InventoryLootSelector` and implementing the `GenerateLoot` function.

When creating the resulting `InventoryDefaultItem` array, follow these rules:

- Always set the **Source Inventory** in each entry, which is required to enable the transfer operation.
- If the loot originates from an actual Inventory Item, also set the **Source Item** reference in the entry.

## Loot Events

The Inventory Manager broadcasts the following events to support gameplay systems, UI, and scripting integration:

| Event               | Description                                                                         |
|---------------------|-------------------------------------------------------------------------------------|
| `OnLootGenerated`   | Broadcast when loot is generated on the authoritative Inventory Manager.            |
| `OnLootReceived`    | Broadcast when loot is received by the requester (both authority and local client). |
| `OnLootTransferred` | Broadcast after loot is successfully transferred from the source.                   |
